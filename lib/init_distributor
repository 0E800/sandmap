#!/usr/bin/env bash

# shellcheck shell=bash

# ``````````````````````````````````````````````````````````````````````````````
# Function name: init_distributor()
#
# Description:
#   Modules distributor.
#
# Usage:
#   init_distributor
#
# Examples:
#   init_distributor
#

function init_distributor() {

  # shellcheck disable=SC2034
  local _FUNCTION_ID="init_distributor"
  local _STATE=0

  # shellcheck disable=SC2154
  if [[ "${input_array[0]}" == "show" ]] ; then

      if [[ "${#input_array[1]}" -eq 0 ]] ; then

        printf "stdout: %s\n" "unknown argument"

      elif [[ "${input_array[1]}" == "modules" ]] ; then

        _modules_count=$(find "${_modules}" -name '*.mod' | wc -l)

        printf "\n\t%s: \e[1;31m%s\e[m\n" \
        "Modules" "$_modules_count"

        printf "\n\t%s\n" \
        "List:"

        for i in $(find "${_modules}" -name '*.mod' -exec ls {} + | sort -k 10) ; do

          _fpath=$(basename "$i")
          _fname=$(echo "$_fpath" | cut -d "." -f1)

          printf "\t  \e[1;38m%s\e[m (full name: \e[2;37m%s\e[m)\n" "$_fname" "$_fpath"

        done

        echo

      else

        # shellcheck disable=SC2154
        init_module "command" "${input_array[@]}"

        # shellcheck disable=SC2154
        printf "%s\n\n" "${_module_opts[1]}"

        # shellcheck disable=SC2154
        printf "%s\n\n" "${_module_opts[0]}"

      fi

  else

    # shellcheck disable=SC2154
    init_module "module" "${input_array[@]}"

  fi

  return $_STATE

}
